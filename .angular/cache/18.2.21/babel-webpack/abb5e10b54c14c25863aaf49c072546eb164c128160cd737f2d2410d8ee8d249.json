{"ast":null,"code":"import { inject, NgZone, computed, signal, effect, untracked, VERSION } from \"@angular/core\";\nimport { QueryClient, notifyManager, shouldThrowError } from \"@tanstack/query-core\";\nimport { signalProxy } from \"./signal-proxy.mjs\";\nimport { injectIsRestoring } from \"./inject-is-restoring.mjs\";\nimport { PENDING_TASKS } from \"./pending-tasks-compat.mjs\";\nfunction createBaseQuery(optionsFn, Observer) {\n  const ngZone = inject(NgZone);\n  const pendingTasks = inject(PENDING_TASKS);\n  const queryClient = inject(QueryClient);\n  const isRestoring = injectIsRestoring();\n  const defaultedOptionsSignal = computed(() => {\n    const defaultedOptions = queryClient.defaultQueryOptions(optionsFn());\n    defaultedOptions._optimisticResults = isRestoring() ? \"isRestoring\" : \"optimistic\";\n    return defaultedOptions;\n  });\n  const observerSignal = (() => {\n    let instance = null;\n    return computed(() => {\n      return instance || (instance = new Observer(queryClient, defaultedOptionsSignal()));\n    });\n  })();\n  const optimisticResultSignal = computed(() => observerSignal().getOptimisticResult(defaultedOptionsSignal()));\n  const resultFromSubscriberSignal = signal(null);\n  effect(onCleanup => {\n    const observer = observerSignal();\n    const defaultedOptions = defaultedOptionsSignal();\n    untracked(() => {\n      observer.setOptions(defaultedOptions);\n    });\n    onCleanup(() => {\n      ngZone.run(() => resultFromSubscriberSignal.set(null));\n    });\n  }, {\n    // Set allowSignalWrites to support Angular < v19\n    // Set to undefined to avoid warning on newer versions\n    allowSignalWrites: VERSION.major < \"19\" || void 0\n  });\n  effect(onCleanup => {\n    const observer = observerSignal();\n    let pendingTaskRef = null;\n    const unsubscribe = isRestoring() ? () => void 0 : untracked(() => ngZone.runOutsideAngular(() => {\n      return observer.subscribe(notifyManager.batchCalls(state => {\n        ngZone.run(() => {\n          if (state.fetchStatus === \"fetching\" && !pendingTaskRef) {\n            pendingTaskRef = pendingTasks.add();\n          }\n          if (state.fetchStatus === \"idle\" && pendingTaskRef) {\n            pendingTaskRef();\n            pendingTaskRef = null;\n          }\n          if (state.isError && !state.isFetching && shouldThrowError(observer.options.throwOnError, [state.error, observer.getCurrentQuery()])) {\n            ngZone.onError.emit(state.error);\n            throw state.error;\n          }\n          resultFromSubscriberSignal.set(state);\n        });\n      }));\n    }));\n    onCleanup(() => {\n      if (pendingTaskRef) {\n        pendingTaskRef();\n        pendingTaskRef = null;\n      }\n      unsubscribe();\n    });\n  });\n  return signalProxy(computed(() => {\n    const subscriberResult = resultFromSubscriberSignal();\n    const optimisticResult = optimisticResultSignal();\n    const result = subscriberResult ?? optimisticResult;\n    const observer = observerSignal();\n    const originalRefetch = result.refetch;\n    return {\n      ...result,\n      refetch: (...args) => {\n        observer.setOptions(defaultedOptionsSignal());\n        return originalRefetch(...args);\n      }\n    };\n  }));\n}\nexport { createBaseQuery };","map":{"version":3,"names":["inject","NgZone","computed","signal","effect","untracked","VERSION","QueryClient","notifyManager","shouldThrowError","signalProxy","injectIsRestoring","PENDING_TASKS","createBaseQuery","optionsFn","Observer","ngZone","pendingTasks","queryClient","isRestoring","defaultedOptionsSignal","defaultedOptions","defaultQueryOptions","_optimisticResults","observerSignal","instance","optimisticResultSignal","getOptimisticResult","resultFromSubscriberSignal","onCleanup","observer","setOptions","run","set","allowSignalWrites","major","pendingTaskRef","unsubscribe","runOutsideAngular","subscribe","batchCalls","state","fetchStatus","add","isError","isFetching","options","throwOnError","error","getCurrentQuery","onError","emit","subscriberResult","optimisticResult","result","originalRefetch","refetch","args"],"sources":["E:/Projects/pokemon-angular-2025/node_modules/@tanstack/angular-query-experimental/create-base-query.mjs"],"sourcesContent":["import { inject, NgZone, computed, signal, effect, untracked, VERSION } from \"@angular/core\";\nimport { QueryClient, notifyManager, shouldThrowError } from \"@tanstack/query-core\";\nimport { signalProxy } from \"./signal-proxy.mjs\";\nimport { injectIsRestoring } from \"./inject-is-restoring.mjs\";\nimport { PENDING_TASKS } from \"./pending-tasks-compat.mjs\";\nfunction createBaseQuery(optionsFn, Observer) {\n  const ngZone = inject(NgZone);\n  const pendingTasks = inject(PENDING_TASKS);\n  const queryClient = inject(QueryClient);\n  const isRestoring = injectIsRestoring();\n  const defaultedOptionsSignal = computed(() => {\n    const defaultedOptions = queryClient.defaultQueryOptions(optionsFn());\n    defaultedOptions._optimisticResults = isRestoring() ? \"isRestoring\" : \"optimistic\";\n    return defaultedOptions;\n  });\n  const observerSignal = (() => {\n    let instance = null;\n    return computed(() => {\n      return instance || (instance = new Observer(queryClient, defaultedOptionsSignal()));\n    });\n  })();\n  const optimisticResultSignal = computed(\n    () => observerSignal().getOptimisticResult(defaultedOptionsSignal())\n  );\n  const resultFromSubscriberSignal = signal(null);\n  effect(\n    (onCleanup) => {\n      const observer = observerSignal();\n      const defaultedOptions = defaultedOptionsSignal();\n      untracked(() => {\n        observer.setOptions(defaultedOptions);\n      });\n      onCleanup(() => {\n        ngZone.run(() => resultFromSubscriberSignal.set(null));\n      });\n    },\n    {\n      // Set allowSignalWrites to support Angular < v19\n      // Set to undefined to avoid warning on newer versions\n      allowSignalWrites: VERSION.major < \"19\" || void 0\n    }\n  );\n  effect((onCleanup) => {\n    const observer = observerSignal();\n    let pendingTaskRef = null;\n    const unsubscribe = isRestoring() ? () => void 0 : untracked(\n      () => ngZone.runOutsideAngular(() => {\n        return observer.subscribe(\n          notifyManager.batchCalls((state) => {\n            ngZone.run(() => {\n              if (state.fetchStatus === \"fetching\" && !pendingTaskRef) {\n                pendingTaskRef = pendingTasks.add();\n              }\n              if (state.fetchStatus === \"idle\" && pendingTaskRef) {\n                pendingTaskRef();\n                pendingTaskRef = null;\n              }\n              if (state.isError && !state.isFetching && shouldThrowError(observer.options.throwOnError, [\n                state.error,\n                observer.getCurrentQuery()\n              ])) {\n                ngZone.onError.emit(state.error);\n                throw state.error;\n              }\n              resultFromSubscriberSignal.set(state);\n            });\n          })\n        );\n      })\n    );\n    onCleanup(() => {\n      if (pendingTaskRef) {\n        pendingTaskRef();\n        pendingTaskRef = null;\n      }\n      unsubscribe();\n    });\n  });\n  return signalProxy(\n    computed(() => {\n      const subscriberResult = resultFromSubscriberSignal();\n      const optimisticResult = optimisticResultSignal();\n      const result = subscriberResult ?? optimisticResult;\n      const observer = observerSignal();\n      const originalRefetch = result.refetch;\n      return {\n        ...result,\n        refetch: (...args) => {\n          observer.setOptions(defaultedOptionsSignal());\n          return originalRefetch(...args);\n        }\n      };\n    })\n  );\n}\nexport {\n  createBaseQuery\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}